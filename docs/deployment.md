# Deployment Notes

1. **Render service**  
   - Runtime: Python 3.11 (matches local requirements).  
   - Build command: `pip install -r requirements.txt`.  
   - Start command: `uvicorn app.main:app --host 0.0.0.0 --port $PORT`.  
   - Health check: configure `/healthz` (or `/health`) so Render can monitor availability.

2. **Database**  
   - Provision a managed Postgres instance using Render's Postgres add-on (or any hosted Postgres).  
   - Supply the provided connection string via the `DATABASE_URL` secret; `app.core.config.Settings` automatically converts it to `postgresql+asyncpg://`.  
   - Because `app.main.on_startup` calls `init_db`, the database tables and gate/route seed data are created before the first request if they do not already exist.

3. **Environment variables**
   - `DATABASE_URL`: required for production/Postgres connection.  
   - Optional overrides taken from `.env` for local testing (`DB_HOST`, `DB_PORT`, `DB_NAME`, `DB_USER`, `DB_PASSWORD`, `APP_NAME`, `ENVIRONMENT`).

4. **Deployment workflow**
   - Connect your Render service to this repo (auto-deploy on push).  
   - Ensure the Postgres add-on is toggled before the first deployment so `DATABASE_URL` is available during startup.  
   - The API docs stay live at `https://{your-render-service}.onrender.com/docs` (we currently host them at `https://hstc-api.onrender.com/docs`).

5. **Render Postgres instance**
   - Service: `hstc-postgres` (PG 18, Oregon / US-West region).  
   - Plan: Free tier (`256 MB RAM`, `0.1 CPU`, `1 GB storage`); note the instance expires on **March 4, 2026** unless upgraded.  
   - Credentials: standard Render Postgres defaults (`hstc` / autogenerated password) exposed via the dashboard and used by the `DATABASE_URL` secret.
   - The internal hostname is `dpg-d60927nfte5s73db2ftg-a`, port `5432`, database `hstc`.

6. **Optional IaC next steps**
   - If you prefer pull-request friendly infrastructure, capture the Render service + Postgres add-on in Terraform/Render YAML.  
   - Otherwise, document the Render dashboard steps here so reviewers can replicate the deployment without Terraform.

5. **Optional IaC next steps**
   - If you prefer pull-request friendly infrastructure, capture the Render service + Postgres add-on in Terraform/Render YAML.  
   - Otherwise, document the Render dashboard steps here so reviewers can replicate the deployment without Terraform.
